{% extends "base.html" %}

{% block title %}Reconocimientos{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-center mb-4">Reconocimientos Generados</h1>

<!-- Toast de confirmación -->
<div id="toast" class="fixed bottom-4 right-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg hidden"></div>

<!-- Filtros -->
<div class="flex justify-between items-center mb-4">
  <div class="flex items-center space-x-2">
    <span class="text-sm text-gray-600">Filtrar por:</span>
    <select id="filter-region" class="border border-gray-300 rounded-lg p-2">
      <option value="">Todas las Regiones</option>
      <option>Norte</option>
      <option>Sur</option>
    </select>
    <input type="text" id="search" placeholder="Buscar por cédula..." class="border border-gray-300 rounded-lg p-2">
  </div>
</div>

<!-- Tabla de Resultados -->
<div class="bg-white shadow-md rounded-lg overflow-hidden">
  <table class="min-w-full leading-normal">
    <thead>
      <tr>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Código</th>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nombre</th>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cédula</th>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Grupo</th>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Distrito</th>
        <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">PDF</th>
      </tr>
    </thead>
    <tbody>
      {% for reconocimiento in reconocimientos %}
      <tr class="hover:bg-gray-100">
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">{{ reconocimiento[1] }}</td>
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">{{ reconocimiento[3] }}</td>
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm cedula">{{ reconocimiento[4] }}</td>
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">{{ reconocimiento[5] }}</td>
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm region">{{ reconocimiento[6] }}</td>
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
          <a href="/output/{{ reconocimiento[1] }}.pdf" target="_blank" class="text-blue-500 hover:text-blue-800">Descargar</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // Filtro dinámico
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("search");
    const regionFilter = document.getElementById("filter-region");
    const tableRows = document.querySelectorAll("tbody tr");

    function filterTable() {
      const searchTerm = searchInput.value.toLowerCase();
      const region = regionFilter.value;

      tableRows.forEach((row) => {
        const cedula = row.querySelector(".cedula").textContent.toLowerCase();
        const regionRow = row.querySelector(".region").textContent;
        const matchSearch = cedula.includes(searchTerm);
        const matchRegion = region === "" || regionRow === region;

        row.style.display = matchSearch && matchRegion ? "" : "none";
      });
    }

    searchInput.addEventListener("input", filterTable);
    regionFilter.addEventListener("change", filterTable);
  });

  // Mostrar toast si hay éxito en la generación
  const urlParams = new URLSearchParams(window.location.search);
  const successCount = urlParams.get("success");

  if (successCount) {
    const toast = document.getElementById("toast");
    toast.textContent = `✅ Se generaron ${successCount} reconocimientos exitosamente`;
    toast.classList.remove("hidden");
    setTimeout(() => toast.classList.add("hidden"), 3000);
  }
</script>
{% endblock %}